{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Terminal</title>

    <!-- =============================
         External Stylesheets
         ============================= -->
    <!-- Tailwind CSS for utility-first styling -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <!-- Google Fonts for typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <!-- Custom styles specific to the project -->

  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <!-- Google Fonts for typography -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <!-- Custom styles specific to the project -->
    <link rel="stylesheet" href="{% static 'dashboard/styles.css' %}">
    <!-- RMS Modal styles -->
    <link rel="stylesheet" href="{% static 'dashboard/rms-styles.css' %}">

</head>

<body class="bg-gray-100 h-screen flex flex-col font-inter">


    <!-- =============================
         Header Section
         ============================= -->
    <header class="bg-indigo-600 text-white p-4 flex justify-between items-center">
        <!-- App Title -->
        <h1 class="text-xl font-bold">Trading Terminal</h1>
        
        <!-- Action Buttons (Login, Settings) -->
        <div class="flex gap-4">
           <form method="POST" action="/login/">
    {% csrf_token %}
    <button type="submit" class="px-4 py-2 bg-indigo-700 rounded hover:bg-indigo-800 transition duration-200 flex items-center">
        <i class="fas fa-sign-in-alt mr-2"></i> Login
    </button>
</form>



            <button onclick="openRMSSettings()" class="px-4 py-2 bg-indigo-700 rounded hover:bg-indigo-800 transition duration-200 flex items-center">
                <i class="fas fa-cog mr-2"></i> RMS Settings
            </button>
        </div>
    </header>



    <!-- =============================
     FUTIDX and OPTIDX Toggle
     ============================= -->
<div class="flex justify-center mb-4">
    <div class="toggle-container">
        <button id="optidx-btn" class="tab-button active" onclick="showOptidx()">OPTIDX</button>
        <button id="futidx-btn" class="tab-button" onclick="showFutidx()">FUTIDX</button>
    </div>
</div>
 <!-- ===========================
         Main Resizable Container
         ============================= -->
    <div id="resizable-container" class="flex-grow flex p-4 gap-2 min-h-full">

        <!-- ===========================
             Positions Section (Resizable)
             =========================== -->
        <div id="positions-table" class="bg-white p-4 shadow-lg rounded-lg min-w-[200px] max-w-[75%] flex-shrink-0 overflow-x-auto">
            
            <!-- Stats Cards -->
            <div class="grid grid-cols-3 gap-4 mb-4">
                <div class="bg-blue-100 p-4 rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-blue-800">Total P&L</h3>
                    <p class="text-2xl font-bold text-blue-600">$5,000</p>
                </div>
                <div class="bg-green-100 p-4 rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-green-800">Open Positions</h3>
                    <p class="text-2xl font-bold text-green-600">12</p>
                </div>
                <div class="bg-purple-100 p-4 rounded-lg shadow">
                    <h3 class="text-lg font-semibold text-purple-800">Available Margin</h3>
                    <p class="text-2xl font-bold text-purple-600">$25,000</p>
                </div>
            </div>

            <!-- MTM Label (highlighted and centered) -->
            <div class="text-center mb-4">
                <div class="bg-green-100 text-green-700 font-bold text-lg inline-block px-6 py-2 rounded-lg">
                    MTM: <span id="mtm-value">$1500</span>
                </div>
            </div>

            <!-- Tabs for Positions, Orderbook, Tradebook -->
            <div class="flex justify-between mb-4 bg-gray-200 p-2 rounded">
                <div class="flex gap-2">
                    <button id="positions-tab" class="px-4 py-1 text-white bg-blue-500 rounded hover:bg-blue-600 transition duration-200">Positions</button>
                    <button id="orderbook-tab" class="px-4 py-1 text-black bg-gray-300 rounded hover:bg-gray-400 transition duration-200">Orderbook</button>
                    <button id="tradebook-tab" class="px-4 py-1 text-black bg-gray-300 rounded hover:bg-gray-400 transition duration-200">Tradebook</button>
                </div>

                <!-- Control Buttons (Refresh, Cancel All, Exit All) -->
                <div class="flex gap-2">
                    <button id="refresh-button" class="px-4 py-1 text-white bg-blue-500 rounded hover:bg-blue-600 transition duration-200">Refresh</button>
                    <button id="cancel-all-button" class="px-4 py-1 text-white bg-purple-600 rounded hover:bg-purple-700 transition duration-200">Cancel All</button>
                    <button id="exit-all-button" class="px-4 py-1 text-white bg-red-500 rounded hover:bg-red-600 transition duration-200">Exit All</button>
                </div>
            </div>

            <!-- Table Display for Positions -->
            <table class="w-full text-left border-collapse mb-4">
    <thead class="bg-indigo-500 text-white border-b border-gray-300">
        <tr>
            <th class="px-3 py-2 border">Symbol</th>
            <th class="px-3 py-2 border">Avg Price</th>
            <th class="px-3 py-2 border">Qty</th>
            <th class="px-3 py-2 border">S/L</th>
            <th class="px-3 py-2 border">Target</th>
            <th class="px-3 py-2 border">Pos</th>
            <th class="px-3 py-2 border">LTP</th>
            <th class="px-3 py-2 border">P&L</th>
            <th class="px-3 py-2 border">Unrealized P&L</th>
            <th class="px-3 py-2 border">Action</th>
        </tr>
    </thead>
    <tbody id="positions-body" class="text-black">
        <!-- Dynamic rows will be inserted here by JavaScript -->
    </tbody>
</table>


            <!-- Pagination Controls -->
            <div class="flex justify-center">
                <button id="prev-page" class="px-4 py-1 bg-gray-200 text-black rounded hover:bg-gray-300 transition duration-200">Previous</button>
                <button id="next-page" class="px-4 py-1 bg-gray-200 text-black rounded hover:bg-gray-300 transition duration-200 ml-4">Next</button>
            </div>
        </div>

        <!-- =============================
             Resizable Divider (Drag Handle)
             ============================= -->
        <div id="drag-handle" class="w-1 bg-gray-300 cursor-col-resize hover:bg-gray-400 transition duration-200"></div>



<!-- OPTIDX Panel -->
 <div id="optidx-panel" class="panel-container">
    <div id="optidx-order-placement-form" class="bg-indigo-600 text-white p-6 shadow-lg rounded-lg flex-grow">
        <!-- New Order Placement Section (OPTIDX) -->
         <div class="grid grid-cols-2 gap-4 mb-4">
            <!-- Exchange and Segment Fields with Default Values -->
            <div>
                <label for="optidx-exchange" class="block mb-1">Exchange</label>
                <select id="optidx-exchange" class="w-full p-2 rounded bg-indigo-700 text-white" disabled>
                    <option value="NFO" selected>NFO</option>
                </select>
            </div>
            <div>
                <label for="optidx-segment" class="block mb-1">Segment</label>
                <select id="optidx-segment" class="w-full p-2 rounded bg-indigo-700 text-white" disabled>
                    <option value="OPTIDX" selected>OPTIDX</option>
                </select>
            </div>
        </div>
        <div class="grid grid-cols-2 gap-4 mb-4">
              <!-- Symbol and Expiry Fields -->
            <div>
                <select id="optidx-symbol" class="w-full p-2 rounded bg-indigo-700 text-white">
                    <option>Select Symbol</option>
                    <option value="NIFTY">NIFTY</option>
                    <option value="BANKNIFTY">BANKNIFTY</option>
                     <option value="MIDCAPNIFTY">MIDCAPNIFTY</option>
                        <option value="FINNIFTY">FINNIFTY</option>
                    </select>

            </div>
            <div>
                <label for="optidx-expiry" class="block mb-1">Expiry</label>
                <input type="date" id="optidx-expiry" class="w-full p-2 rounded bg-indigo-700 text-white">
            </div>
        </div>
        <div class="grid grid-cols-2 gap-4 mb-4">
             <!-- Quantity and Lots Field with Same Functionality as FUTIDX but Different Function -->
            <div class="flex items-center">
                <input type="number" id="optidx-quantity" class="w-1/2 p-2 rounded bg-indigo-700 text-white mr-2" placeholder="Quantity">
                <select id="optidx-lot-size" class="w-1/2 p-2 rounded bg-indigo-700 text-white">
                    <option>Select Lots</option>
                </select>
            </div>
            <div class="flex items-center">
                <select id="optidx-product" class="w-1/2 p-2 rounded bg-indigo-700 text-white mr-2" disabled>
                    <option value="MIS" selected>MIS</option>
                </select>
                <select id="optidx-validity" class="w-1/2 p-2 rounded bg-indigo-700 text-white" disabled>
                    <option value="DAY" selected>DAY</option>
                </select>
            </div>
        </div>
<div class="flex justify-center mb-4">
    <h1 class="text-yellow-100 rounded font-bold text-lg">
        <!-- This text will be dynamically updated -->
    </h1>
</div>

        <!-- Call and Put Panels with Strike Selection -->
        <div class="grid grid-cols-2 gap-4">
            <!-- ===========================
                 Call Panel
                 =========================== -->
            <div class="flex flex-col justify-around bg-green-100 p-4 rounded-lg">
                <div class="text-center mb-2">
                    <label for="call-strike" class="block mb-1 text-black font-semibold">Call Strike</label>
                    <div class="flex items-center justify-center">
                        <button id="call-strike-minus" class="bg-green-500 text-white p-2 rounded-l">-</button>

                        <select id="call-strike" class="w-full p-2 bg-white text-black text-center">
    <option>Select Strike</option>
</select>
                         <button id="call-strike-plus" class="bg-green-500 text-white p-2 rounded-r">+</button>
                    </div>
                </div>
                <div class="text-center mb-2">
                    <label for="call-ltp" class="block mb-1 text-black font-semibold">LTP</label>
                    <span id="call-ltp" class="font-bold text-black">0.00</span>
                </div>
                <div class="flex justify-center items-center mb-2">
                    <label class="switch mr-2">
                        <input type="checkbox" id="call-mkt-ltp-toggle">
                        <span class="slider round"></span>
                    </label>
                    <span class="text-black text-sm">MKT -- LTP</span>
                </div>
                <div class="flex justify-between mb-2">
                 <button id="buy-ce-button" class="w-1/2 p-2 bg-green-500 text-white rounded font-bold text-sm">BUY CE</button>
                    <button id="sell-ce-optidx" class="w-1/2 p-2 bg-red-500 text-white rounded font-bold text-sm ml-1">SELL CE</button>
                </div>
                <div class="grid grid-cols-4 gap-2 mb-2">
                    <button class="p-1 bg-blue-600 text-white rounded text-xs">25%</button>
                    <button class="p-1 bg-blue-600 text-white rounded text-xs">50%</button>
                    <button class="p-1 bg-blue-600 text-white rounded text-xs">75%</button>
                    <button class="p-1 bg-blue-600 text-white rounded text-xs">100%</button>
                </div>
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <div>
                        <label for="call-limit-price" class="block mb-1 text-black text-sm">Limit Price</label>
                        <input type="number" id="call-limit-price" class="w-full p-2 rounded bg-white text-black" placeholder="Price">
                    </div>
                    <div>
                        <label for="call-limit-qty" class="block mb-1 text-black text-sm">Limit Qty</label>
                        <input type="number" id="call-limit-qty" class="w-full p-2 rounded bg-white text-black" placeholder="Qty">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <button id="call-b-button" class="p-2 bg-green-500 text-white rounded font-bold">B</button>
                    <button id="call-s-button" class="p-2 bg-red-500 text-white rounded font-bold">S</button>
                </div>
            </div>

            <!-- ===========================
                 Put Panel
                 =========================== -->
            <div class="flex flex-col justify-around bg-red-100 p-4 rounded-lg">
                <div class="text-center mb-2">
                    <label for="put-strike" class="block mb-1 text-black font-semibold">Put Strike</label>
                    <div class="flex items-center justify-center">
                         <button id="put-strike-minus" class="bg-red-500 text-white p-2 rounded-l">-</button>

                        <select id="put-strike" class="w-full p-2 bg-white text-black text-center">
                          <option>Select Strike</option>
                        </select>
                    <button id="put-strike-plus" class="bg-red-500 text-white p-2 rounded-r">+</button>
                    </div>
                </div>
                <div class="text-center mb-2">
                    <label for="put-ltp" class="block mb-1 text-black font-semibold">LTP</label>
                    <span id="put-ltp" class="font-bold text-black">0.00</span>
                </div>
                <div class="flex justify-center items-center mb-2">
                    <label class="switch mr-2">
                        <input type="checkbox" id="put-mkt-ltp-toggle">
                        <span class="slider round"></span>
                    </label>
                    <span class="text-black text-sm">MKT -- LTP</span>
                </div>
                <div class="flex justify-between mb-2">
                <button id="buy-pe-optidx" class="w-1/2 p-2 bg-green-500 text-white rounded font-bold text-sm mr-1">BUY PE</button>
                    <button id="sell-pe-optidx" class="w-1/2 p-2 bg-red-500 text-white rounded font-bold text-sm ml-1">SELL PE</button>
                </div>
                <div class="grid grid-cols-4 gap-2 mb-2">
                    <button class="p-1 bg-blue-600 text-white rounded text-xs">25%</button>
                    <button class="p-1 bg-blue-600 text-white rounded text-xs">50%</button>
                    <button class="p-1 bg-blue-600 text-white rounded text-xs">75%</button>
                    <button class="p-1 bg-blue-600 text-white rounded text-xs">100%</button>
                </div>
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <div>
                        <label for="put-limit-price" class="block mb-1 text-black text-sm">Limit Price</label>
                        <input type="number" id="put-limit-price" class="w-full p-2 rounded bg-white text-black" placeholder="Price">
                    </div>
                    <div>
                        <label for="put-limit-qty" class="block mb-1 text-black text-sm">Limit Qty</label>
                        <input type="number" id="put-limit-qty" class="w-full p-2 rounded bg-white text-black" placeholder="Qty">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <button id="put-b-button" class="p-2 bg-green-500 text-white rounded font-bold">B</button>
                    <button id="put-s-button" class="p-2 bg-red-500 text-white rounded font-bold">S</button>
                </div>
            </div>
        </div>
    </div>
  </div>



<!-- FUTIDX Panel -->
<form id="futidx-form" method="POST" action="{% url 'futidx_buy' %}">
    {% csrf_token %}
    <input type="hidden" id="futidx-action" name="action" value="buy">
<div id="futidx-panel" class="panel-container hidden">
    <div id="futidx-order-placement-form" class="bg-indigo-600 text-white p-6 shadow-lg rounded-lg flex-grow">

        <!-- New Order Placement Section (FUTIDX) -->
        <div class="grid grid-cols-2 gap-4 mb-4">
            <!-- Exchange Field -->
            <div>
                <label for="futidx-exchange" class="block mb-1">Exchange</label>
                <select id="futidx-exchange" class="w-full p-2 rounded bg-indigo-700 text-white" disabled>
                    <option value="NFO">NFO</option>
                </select>
            </div>

            <!-- Segment Field -->
            <div>
                <label for="futidx-segment" class="block mb-1">Segment</label>
                <select id="futidx-segment" class="w-full p-2 rounded bg-indigo-700 text-white" disabled>
                    <option value="FUTIDX">FUTIDX</option>
                </select>
            </div>
        </div>
        <div class="grid grid-cols-2 gap-4 mb-4">
             <!-- Symbol Field -->
           <div class="grid grid-cols-2 gap-4 mb-4">
            <label for="futidx-symbol" class="block mb-1">Symbol</label>
            <select id="futidx-symbol" class="w-full p-2 rounded bg-indigo-700 text-white" name="symbol">
                <option value="">Select Symbol</option>
                <option value="NIFTY">NIFTY</option>
                <option value="BANKNIFTY">BANKNIFTY</option>
                <option value="MIDCAPNIFTY">MIDCAPNIFTY</option>
                <option value="FINNIFTY">FINNIFTY</option>
            </select>
        </div>
             <!-- Expiry Field -->
            <div class="grid grid-cols-2 gap-4 mb-4">
                <label for="futidx-expiry" class="block mb-1">Expiry</label>
                <input type="date" id="futidx-expiry" class="w-full p-2 rounded bg-indigo-700 text-white" name="expiry">
            </div>
        </div>
        <div class="grid grid-cols-2 gap-4 mb-4">
             <!-- Quantity and Lots Field -->

            <div class="grid grid-cols-2 gap-4 mb-4">
            <label for="futidx-quantity" class="block mb-1">Quantity</label>
            <input type="number" id="futidx-quantity" class="w-1/2 p-2 rounded bg-indigo-700 text-white mr-2" placeholder="Quantity" name="quantity">
            <select id="lot-size" class="w-1/2 p-2 rounded bg-indigo-700 text-white">
    <option>Select Lots</option>
</select>


            </div>
              <!-- Product and Validity Field -->

            <div class="flex items-center">
                 <select id="futidx-product" class="w-1/2 p-2 rounded bg-indigo-700 text-white mr-2">
                    <option value="INTRADAY">INTRADAY</option>
                </select>
                <select id="futidx-validity" class="w-1/2 p-2 rounded bg-indigo-700 text-white">
                    <option value="DAY">DAY</option>
                </select>
            </div>
        </div>
        <div class="flex justify-center mb-4">
            <h1 class="text-yellow-100 rounded font-bold text-lg">
                Bank Nifty Feb FUT
            </h1>
        </div>
        <!-- Call and Put Panels -->
        <div class="grid grid-cols-2 gap-4">
            <!-- ===========================
                 Call Panel
                 =========================== -->
            <div class="flex flex-col justify-around bg-green-100 p-4 rounded-lg">
                <div class="flex justify-center">
                         <button type="submit" class="w-1/2 p-2 bg-green-500 text-white rounded font-bold text-sm my-6" onclick="setAction('buy')">BUY</button>

                    <div class="text-center my-6 ml-10">
                        <label for="futidx-call-ltp" class="block text-black font-semibold">LTP</label>
                        <span id="futidx-call-ltp" class="font-bold text-black">0.00</span>
                    </div>
                    <div class="flex justify-center items-center my-6 ml-2">
                        <label class="switch mr-2">
                            <input type="checkbox" id="futidx-call-mkt-ltp-toggle">
                            <span class="slider round"></span>
                        </label>
                        <span class="text-black text-sm font-bold">MKT -- LTP</span>
                    </div>
                </div>
                <div class="grid grid-cols-4 gap-2">
                    <button class="p-1 bg-blue-600 text-white rounded text-xs">25%</button>
                    <button class="p-1 bg-blue-600 text-white rounded text-xs">50%</button>
                    <button class="p-1 bg-blue-600 text-white rounded text-xs">75%</button>
                    <button class="p-1 bg-blue-600 text-white rounded text-xs">100%</button>
                </div>
               <div class="flex gap-2 my-6">
    <label for="futidx-buy-limit-price" class="block mb-1 text-black font-bold text-sm">Limit Price</label>
    <input type="number" id="futidx-buy-limit-price" class="w-full p-2 rounded bg-white text-black" placeholder="Price" name="limit_price">

    <label for="futidx-buy-limit-qty" class="block mb-1 text-black font-bold text-sm">Limit Qty</label>
    <input type="number" id="futidx-buy-limit-qty" class="w-full p-2 rounded bg-white text-black" placeholder="Qty" name="limit_qty">

    <button class="w-1/3 p-2 bg-green-500 text-white rounded font-bold mr-2" id="futidx-b-button" type="button"
            onclick="setAction('B'); submitForm()">B</button>
</div>

            </div>

            <!-- ===========================
                 Put Panel
                 =========================== -->
            <div class="flex flex-col justify-around bg-red-100 p-4 rounded-lg">
                <div class="flex justify-center mb-2">
                 <button type="submit" class="w-1/2 p-2 bg-red-500 text-white rounded font-bold text-sm my-6" onclick="setAction('sell')">SELL</button>
                    <div class="text-center my-6 ml-10">
                        <label for="futidx-put-ltp" class="block text-black font-semibold">LTP</label>
                        <span id="futidx-put-ltp" class="font-bold text-black">0.00</span>
                    </div>
                    <div class="flex justify-center items-center my-6 ml-6">
                        <label class="switch mr-2">
                            <input type="checkbox" id="futidx-put-mkt-ltp-toggle">
                            <span class="slider round"></span>
                        </label>
                        <span class="text-black text-sm font-bold">MKT -- LTP</span>
                    </div>
                </div>
                <div class="grid grid-cols-4 gap-2 mb-6">
                    <button class="p-1 bg-blue-600 text-white rounded text-xs">25%</button>
                    <button class="p-1 bg-blue-600 text-white rounded text-xs">50%</button>
                    <button class="p-1 bg-blue-600 text-white rounded text-xs">75%</button>
                    <button class="p-1 bg-blue-600 text-white rounded text-xs">100%</button>
                </div>
                <div class="flex gap-2 my-6">
                     <label for="futidx-sell-limit-price" class="block mb-1 text-black font-bold text-sm">Limit Price</label>
                <input type="number" id="futidx-sell-limit-price" class="w-full p-2 rounded bg-white text-black" placeholder="Price" name="sell-limit-price">
                <label for="futidx-sell-limit-qty" class="block mb-1 text-black font-bold text-sm">Limit Qty</label>
                <input type="number" id="futidx-sell-limit-qty" class="w-full p-2 rounded bg-white text-black" placeholder="Qty" name="sell-limit-qty">
                <button class="w-1/3 p-2 bg-red-500 text-white rounded font-bold mr-2" id="futidx-s-button"
                        type="button" onclick="setAction('S'); submitForm()">S</button>
                </div>
            </div>
        </div>

        <!-- ===========================
             Target and Stop Loss Section
             =========================== -->
        <div class="grid grid-cols-2 gap-4 mt-4">
            <div>
                <label for="futidx-target" class="block mb-1">Target</label>
                <input type="number" id="futidx-target" class="w-full p-2 rounded bg-indigo-700 text-white" placeholder="Target">
            </div>
            <div>
                <label for="futidx-stop-loss" class="block mb-1">Stop Loss</label>
                <input type="number" id="futidx-stop-loss" class="w-full p-2 rounded bg-indigo-700 text-white" placeholder="Stop Loss">
            </div>
        </div>

        <!-- ===========================
             Exit and Cancel Section
             =========================== -->
        <div class="grid grid-cols-2 gap-4 mt-4">
            <button class="p-2 bg-yellow-500 text-black rounded font-bold">Exit All</button>
            <button class="p-2 bg-purple-500 text-white rounded font-bold">Cancel All</button>
        </div>
    </div>
    </div>

    </form>


    <!-- RMS Modal Structure -->
    <div id="rmsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Risk Management Settings</h2>
                <span class="close-button">&times;</span>
            </div>

            <!-- Modal Body with Sidebar and Content -->
            <div class="modal-body">
                <!-- Sidebar with Tabs -->
                <div class="sidebar">
                    <ul>
                        <li class="active" id="manage-risk-tab">Manage Risk</li>
                        <li id="default-settings-tab">Default Settings</li>
                        <li id="appearance-tab">Appearance</li>
                    </ul>
                </div>

                <!-- Content Sections -->
                <div class="content">
                    <!-- Manage Risk Section -->
                    <div id="manage-risk-content" class="tab-content active">
                        <h3>Day Loss</h3>
                        <label for="day-loss">Max Day Loss:</label>
                        <input type="number" id="day-loss" placeholder="Enter max day loss">
                        <p>What happens when the day loss is hit?</p>
                        <input type="radio" id="square-off-positions" name="day-loss-action" value="square-off">
                        <label for="square-off-positions">Square off all my positions</label><br>
                        <input type="radio" id="square-off-and-lock" name="day-loss-action" value="lock-terminal">
                        <label for="square-off-and-lock">Square off all my positions and lock the terminal for:</label>
                        <select id="lock-duration-day-loss">
                            <option value="15">15 mins</option>
                            <option value="30">30 mins</option>
                            <option value="45">45 mins</option>
                            <option value="1">1 hour</option>
                            <option value="2">2 hours</option>
                            <option value="3">3 hours</option>
                            <option value="full-day">Full Day</option>
                        </select>
                        <br>
                        <button class="clear-btn">Clear Fields</button>
                        <button class="save-btn">Save Setting</button>

                        <h3>Day Profit</h3>
                        <label for="day-profit">Max Day Profit:</label>
                        <input type="number" id="day-profit" placeholder="Enter max day profit">
                        <p>What happens when the day profit is hit?</p>
                        <input type="radio" id="square-off-profit" name="day-profit-action" value="square-off">
                        <label for="square-off-profit">Square off all my positions</label><br>
                        <input type="radio" id="square-off-and-lock-profit" name="day-profit-action" value="lock-terminal">
                        <label for="square-off-and-lock-profit">Square off all my positions and lock the terminal for:</label>
                        <select id="lock-duration-day-profit">
                            <option value="15">15 mins</option>
                            <option value="30">30 mins</option>
                            <option value="45">45 mins</option>
                            <option value="1">1 hour</option>
                            <option value="2">2 hours</option>
                            <option value="3">3 hours</option>
                            <option value="full-day">Full Day</option>
                        </select>
                        <br>
                        <button class="clear-btn">Clear Fields</button>
                        <button class="save-btn">Save Setting</button>

                        <h3>Profit Protect</h3>
                        <label for="profit-protect-level">Set Profit Protection Level:</label>
                        <input type="number" id="profit-protect-level" placeholder="Enter profit level"><br>
                        <label for="profit-to-protect">Select Percentage of Profit to Protect:</label>
                        <select id="profit-to-protect">
                            <option value="50">50%</option>
                            <option value="60">60%</option>
                            <option value="70">70%</option>
                            <option value="80">80%</option>
                            <option value="90">90%</option>
                        </select>
                        <br>
                        <button class="clear-btn">Clear Fields</button>
                        <button class="save-btn">Save Setting</button>

                        <h3>Trade Limit</h3>
                        <label for="trade-limit">Max Number of Trades in a Session:</label>
                        <input type="number" id="trade-limit" placeholder="Enter max trades">
                        <br>
                        <button class="clear-btn">Clear Fields</button>
                        <button class="save-btn">Save Setting</button>

                        <h3>Max Quantity to Trade</h3>
                        <label for="max-quantity">Max Quantity in a Single Trade:</label>
                        <input type="number" id="max-quantity" placeholder="Enter max quantity">
                        <br>
                        <button class="clear-btn">Clear Fields</button>
                        <button class="save-btn">Save Setting</button>

                        <h3>Trade Frequency</h3>
                        <label for="trade-frequency">Number of Trades Allowed:</label>
                        <input type="number" id="trade-frequency" placeholder="Enter number of trades">
                        <label for="trade-duration">In:</label>
                        <select id="trade-duration">
                            <option value="15">15 mins</option>
                            <option value="30">30 mins</option>
                            <option value="45">45 mins</option>
                            <option value="1">1 hour</option>
                            <option value="2">2 hours</option>
                            <option value="3">3 hours</option>
                            <option value="full-day">Full Day</option>
                        </select>
                        <br>
                        <button class="clear-btn">Clear Fields</button>
                        <button class="save-btn">Save Setting</button>
                    </div>

                    <!-- Placeholder Content for Default Settings -->
                    <div id="default-settings-content" class="tab-content">
                        <h3>Default Settings</h3>
                        <p>This section is under construction.</p>
                    </div>

                    <!-- Placeholder Content for Appearance -->
                    <div id="appearance-content" class="tab-content">
                        <h3>Appearance</h3>
                        <p>This section is under construction.</p>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer">
                <button class="reset-btn">Reset</button>
                <button class="save-btn">Save</button>
            </div>
        </div>
    </div>

    <!-- =============================
         External Scripts
         ============================= -->
    <!-- JavaScript for resizing, pagination, and dynamic table loading -->
    <script src="{% static 'dashboard/scripts.js' %}"></script>
    <script src="{% static 'futidx/script.js' %}"></script>
    <!-- RMS Modal scripts -->
    <script src="{% static 'dashboard/rms-scripts.js' %}"></script>

<script>
 // Set the hidden action field based on the button clicked
    function setAction(action) {
        document.getElementById('futidx-action').value = action;
    }

    // Submit the form using AJAX
    function submitForm() {
        const form = document.getElementById('futidx-form');
        const formData = new FormData(form);
        const action = formData.get('action'); // Get the action type (buy, sell, B, S)
        let url;

        // Determine the appropriate URL based on the action type
        if (action === 'buy') {
            url = "{% url 'futidx_buy' %}";
        } else if (action === 'sell') {
            url = "{% url 'futidx_sell' %}";
        } else if (action === 'B') {
            url = "{% url 'b_action' %}";
        } else if (action === 'S') {
            url = "{% url 's_action' %}";
        }

        // Send AJAX request
        fetch(url, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            },
            body: formData
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Network response was not ok.');
        })
        .then(data => {
        /////  alert(`${action} action completed!`);
            console.log("Action:", action, "Symbol:", data.symbol, "Expiry:", data.expiry, "Quantity:", data.quantity, "Limit Price:", data.limit_price, "Limit Qty:", data.limit_qty);
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    // Handle form submission without page reload
    document.getElementById('futidx-form').addEventListener('submit', function(event) {
        event.preventDefault();
        submitForm();
    });

    // Lot size population based on symbol
    document.getElementById('futidx-symbol').addEventListener('change', function () {
        const symbol = this.value;
        const lotSizeSelect = document.getElementById('lot-size');
        const quantityInput = document.getElementById('futidx-quantity');
        lotSizeSelect.innerHTML = '<option>Select Lots</option>';

        let lotMultiplier = 0;
        if (symbol === 'NIFTY' || symbol === 'FINNIFTY') {
            lotMultiplier = 25;
        } else if (symbol === 'BANKNIFTY') {
            lotMultiplier = 15;
        } else if (symbol === 'MIDCAPNIFTY') {
            lotMultiplier = 50;
        }

        // Populate lot sizes in multiples up to 5000
        if (lotMultiplier > 0) {
            for (let i = lotMultiplier; i <= 5000; i += lotMultiplier) {
                const option = document.createElement('option');
                option.value = i;
                option.text = i;
                lotSizeSelect.appendChild(option);
            }
        }

        // Update quantity based on selected lot size
        lotSizeSelect.addEventListener('change', function () {
            quantityInput.value = this.value;
        });
    });

    // Panel toggling functions
    function showOptidx() {
        document.getElementById('optidx-panel').classList.remove('hidden');
        document.getElementById('futidx-panel').classList.add('hidden');
    }

    function showFutidx() {
        document.getElementById('futidx-panel').classList.remove('hidden');
        document.getElementById('optidx-panel').classList.add('hidden');
    }

    // Initialize on page load
    document.addEventListener("DOMContentLoaded", function() {
        showFutidx();
        document.getElementById('futidx-btn').addEventListener('click', showFutidx);
        document.getElementById('optidx-btn').addEventListener('click', showOptidx);
    });

    //optidx
    // Function to handle `Select Lots` functionality for OPTIDX panel
    document.getElementById('optidx-symbol').addEventListener('change', function () {
        const symbol = this.value;
        const lotSizeSelect = document.getElementById('optidx-lot-size');
        const quantityInput = document.getElementById('optidx-quantity');

        // Clear existing options in the lot size dropdown
        lotSizeSelect.innerHTML = '<option>Select Lots</option>';

        let lotMultiplier = 0;

        // Set the lot multiplier based on the selected symbol
        if (symbol === 'NIFTY' || symbol === 'FINNIFTY') {
            lotMultiplier = 25;
        } else if (symbol === 'BANKNIFTY') {
            lotMultiplier = 15;
        } else if (symbol === 'MIDCAPNIFTY') {
            lotMultiplier = 50;
        }

        // Populate the lot size dropdown with options in multiples of the selected lot size
        if (lotMultiplier > 0) {
            for (let i = lotMultiplier; i <= 5000; i += lotMultiplier) {
                const option = document.createElement('option');
                option.value = i;
                option.text = i;
                lotSizeSelect.appendChild(option);
            }
        }

        // Update the quantity input based on the selected lot size
        lotSizeSelect.addEventListener('change', function () {
            const selectedLotSize = this.value;
            quantityInput.value = selectedLotSize;
        });
    });

    //////////////////handle optidx option pannel symbol change
    document.getElementById('optidx-symbol').addEventListener('change', function () {
    const symbol = this.value;

    if (symbol) {
        // Make an AJAX GET request to the Django view
        fetch(`/fetch-symbol-data/?symbol=${symbol}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok.');
                }
                return response.json();
            })
            .then(data => {
                // Update relevant fields with response data
                console.log("Received data:", data);  // Debug: log the response data

                // Example of updating fields like strike prices
                const strikeSelect = document.getElementById('call-strike');
                strikeSelect.innerHTML = '<option>Select Strike</option>';  // Reset options

                data.strike_prices.forEach(price => {
                    const option = document.createElement('option');
                    option.value = price;
                    option.text = price;
                    strikeSelect.appendChild(option);
                });

                // Update expiry dates similarly if needed
            })
            .catch(error => {
                console.error('Fetch error:', error);
            });
    }
});

    /////dynamic strike price allocation
 //optidx-symbol change handler for lot sizes and AJAX request to fetch LTP
document.getElementById('optidx-symbol').addEventListener('change', function () {
    const symbol = this.value;
    const lotSizeSelect = document.getElementById('optidx-lot-size');
    const quantityInput = document.getElementById('optidx-quantity');
    lotSizeSelect.innerHTML = '<option>Select Lots</option>';

    // Determine lot size based on symbol
    let lotMultiplier = 0;
    if (symbol === 'NIFTY' || symbol === 'FINNIFTY') {
        lotMultiplier = 25;
    } else if (symbol === 'BANKNIFTY') {
        lotMultiplier = 15;
    } else if (symbol === 'MIDCAPNIFTY') {
        lotMultiplier = 50;
    }

    // Populate the lot size dropdown
    if (lotMultiplier > 0) {
        for (let i = lotMultiplier; i <= 5000; i += lotMultiplier) {
            const option = document.createElement('option');
            option.value = i;
            option.text = i;
            lotSizeSelect.appendChild(option);
        }
    }

    // Update quantity input based on selected lot size
    lotSizeSelect.addEventListener('change', function () {
        quantityInput.value = this.value;
    });

    // Fetch symbol data to get LTP and update strike prices
    if (symbol) {
        fetch(`/fetch-symbol-data/?symbol=${symbol}`)
            .then(response => response.json())
            .then(data => {
                const roundedLTP = data.rounded_LTP;
                const strikes = data.strikes;

                // Get the call and put strike select elements
                const callStrikeSelect = document.getElementById('call-strike');
                const putStrikeSelect = document.getElementById('put-strike');

                // Clear existing options
                callStrikeSelect.innerHTML = '';
                putStrikeSelect.innerHTML = '';

                // Add 10 up and 10 down options around the rounded LTP for Call and Put Strike
                strikes.forEach(strike => {
                    const optionCall = document.createElement('option');
                    optionCall.value = strike;
                    optionCall.text = strike;
                    callStrikeSelect.appendChild(optionCall);

                    const optionPut = document.createElement('option');
                    optionPut.value = strike;
                    optionPut.text = strike;
                    putStrikeSelect.appendChild(optionPut);
                });

                // Set the rounded_LTP as the default selected strike in both Call and Put
                callStrikeSelect.value = roundedLTP;
                putStrikeSelect.value = roundedLTP;

                // **INSERT THIS NEW CODE HERE**:
                // Update the display section with symbol and LTP
                const displaySection = document.querySelector('#optidx-panel h1');
                displaySection.textContent = `${data.symbol} - LTP: ${data.LTP}`;

                console.log("Rounded LTP:", roundedLTP);
                console.log("Strikes:", strikes);
            })
            .catch(error => console.error('Error fetching symbol data:', error));
    }
});

//change strike price using plus and minus button
    document.addEventListener("DOMContentLoaded", function() {
    const callStrikeSelect = document.getElementById("call-strike");
    const putStrikeSelect = document.getElementById("put-strike");

    // Function to navigate strikes
    function navigateStrikes(selectElement, direction) {
        const options = Array.from(selectElement.options);
        const currentIndex = selectElement.selectedIndex;

        if (direction === "next" && currentIndex < options.length - 1) {
            selectElement.selectedIndex = currentIndex + 1;
        } else if (direction === "previous" && currentIndex > 0) {
            selectElement.selectedIndex = currentIndex - 1;
        }
    }

    // Event listeners for Call Strike
    document.getElementById("call-strike-plus").addEventListener("click", function() {
        navigateStrikes(callStrikeSelect, "next");
    });

    document.getElementById("call-strike-minus").addEventListener("click", function() {
        navigateStrikes(callStrikeSelect, "previous");
    });

    // Event listeners for Put Strike
    document.getElementById("put-strike-plus").addEventListener("click", function() {
        navigateStrikes(putStrikeSelect, "next");
    });

    document.getElementById("put-strike-minus").addEventListener("click", function() {
        navigateStrikes(putStrikeSelect, "previous");
    });
});
///////////optidx order placement
//BUY CE
document.addEventListener("DOMContentLoaded", function() {
    document.getElementById('buy-ce-button').addEventListener('click', function() {
        // Get the required fields
        const symbol = document.getElementById('optidx-symbol').value;
        const expiry = document.getElementById('optidx-expiry').value; // Updated ID here
        const quantity = document.getElementById('optidx-quantity').value;
        const strike = document.getElementById('call-strike').value;

        // Prepare form data
        const formData = new FormData();
        formData.append('symbol', symbol);
        formData.append('expiry', expiry);
        formData.append('quantity', quantity);
        formData.append('strike', strike);

        // Send AJAX POST request
        fetch("/buy-ce-optidx/", {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            },
            body: formData
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Network response was not ok.');
        })
        .then(data => {
            console.log("BUY CE order placed successfully");
            // Optionally, add success feedback to the user here
        })
        .catch(error => console.error('Error:', error));
    });
});


    //SELL CE
document.addEventListener("DOMContentLoaded", function() {
    document.getElementById('sell-ce-optidx').addEventListener('click', function() {
        // Get the required fields
        const symbol = document.getElementById('optidx-symbol').value;
        const expiry = document.getElementById('optidx-expiry').value; // Updated ID here
        const quantity = document.getElementById('optidx-quantity').value;
        const strike = document.getElementById('call-strike').value;

        // Prepare form data
        const formData = new FormData();
        formData.append('symbol', symbol);
        formData.append('expiry', expiry);
        formData.append('quantity', quantity);
        formData.append('strike', strike);

        // Send AJAX POST request
        fetch("/sell-ce-optidx/", {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            },
            body: formData
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Network response was not ok.');
        })
        .then(data => {
            console.log("BUY CE order placed successfully");
            // Optionally, add success feedback to the user here
        })
        .catch(error => console.error('Error:', error));
    });
});

    //BUY PE
    document.addEventListener("DOMContentLoaded", function() {
    document.getElementById('buy-pe-optidx').addEventListener('click', function() {
        // Get the required fields
        const symbol = document.getElementById('optidx-symbol').value;
        const expiry = document.getElementById('optidx-expiry').value; // Updated ID here
        const quantity = document.getElementById('optidx-quantity').value;
        const strike = document.getElementById('put-strike').value;

        // Prepare form data
        const formData = new FormData();
        formData.append('symbol', symbol);
        formData.append('expiry', expiry);
        formData.append('quantity', quantity);
        formData.append('strike', strike);

        // Send AJAX POST request
        fetch("/buy-pe-optidx/", {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            },
            body: formData
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Network response was not ok.');
        })
        .then(data => {
            console.log("BUY CE order placed successfully");
            // Optionally, add success feedback to the user here
        })
        .catch(error => console.error('Error:', error));
    });
});

    //SELL PE
    document.addEventListener("DOMContentLoaded", function() {
    document.getElementById('sell-pe-optidx').addEventListener('click', function() {
        // Get the required fields
        const symbol = document.getElementById('optidx-symbol').value;
        const expiry = document.getElementById('optidx-expiry').value; // Updated ID here
        const quantity = document.getElementById('optidx-quantity').value;
        const strike = document.getElementById('put-strike').value;

        // Prepare form data
        const formData = new FormData();
        formData.append('symbol', symbol);
        formData.append('expiry', expiry);
        formData.append('quantity', quantity);
        formData.append('strike', strike);

        // Send AJAX POST request
        fetch("/sell-pe-optidx/", {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            },
            body: formData
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Network response was not ok.');
        })
        .then(data => {
            console.log("BUY CE order placed successfully");
            // Optionally, add success feedback to the user here
        })
        .catch(error => console.error('Error:', error));
    });
});
    //limit order optidx pannel
   //buy ce limit
      document.addEventListener("DOMContentLoaded", function() {
    document.getElementById('call-b-button').addEventListener('click', function() {
        // Get the required fields
        const symbol = document.getElementById('optidx-symbol').value;
        const expiry = document.getElementById('optidx-expiry').value; // Updated ID here
        const limitQty = document.getElementById('call-limit-qty').value;
        const strike = document.getElementById('put-strike').value;
        const limitPrice = document.getElementById('call-limit-price').value;


        // Prepare form data
        const formData = new FormData();
        formData.append('symbol', symbol);
        formData.append('expiry', expiry);
        formData.append('limitQty', limitQty);
        formData.append('strike', strike);
        formData.append('limitPrice', limitPrice);

        // Send AJAX POST request
        fetch("/buy-call-optidx/", {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            },
            body: formData
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Network response was not ok.');
        })
        .then(data => {
            console.log("BUY CE order placed successfully");
            // Optionally, add success feedback to the user here
        })
        .catch(error => console.error('Error:', error));
    });
});
//sell ce limit
  document.addEventListener("DOMContentLoaded", function() {
    document.getElementById('call-s-button').addEventListener('click', function() {
        // Get the required fields
        const symbol = document.getElementById('optidx-symbol').value;
        const expiry = document.getElementById('optidx-expiry').value; // Updated ID here
        const limitQty = document.getElementById('call-limit-qty').value;
        const strike = document.getElementById('put-strike').value;
        const limitPrice = document.getElementById('call-limit-price').value;


        // Prepare form data
        const formData = new FormData();
        formData.append('symbol', symbol);
        formData.append('expiry', expiry);
        formData.append('limitQty', limitQty);
        formData.append('strike', strike);
        formData.append('limitPrice', limitPrice);

        // Send AJAX POST request
        fetch("/sell-call-optidx/", {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            },
            body: formData
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Network response was not ok.');
        })
        .then(data => {
            console.log("BUY CE order placed successfully");
            // Optionally, add success feedback to the user here
        })
        .catch(error => console.error('Error:', error));
    });
});

    //buy pe limit
  document.addEventListener("DOMContentLoaded", function() {
    document.getElementById('put-b-button').addEventListener('click', function() {
        // Get the required fields
        const symbol = document.getElementById('optidx-symbol').value;
        const expiry = document.getElementById('optidx-expiry').value; // Updated ID here
        const limitQty = document.getElementById('put-limit-qty').value;
        const strike = document.getElementById('put-strike').value;
        const limitPrice = document.getElementById('put-limit-price').value;


        // Prepare form data
        const formData = new FormData();
        formData.append('symbol', symbol);
        formData.append('expiry', expiry);
        formData.append('limitQty', limitQty);
        formData.append('strike', strike);
        formData.append('limitPrice', limitPrice);

        // Send AJAX POST request
        fetch("/buy-put-optidx/", {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            },
            body: formData
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Network response was not ok.');
        })
        .then(data => {
            console.log("BUY CE order placed successfully");
            // Optionally, add success feedback to the user here
        })
        .catch(error => console.error('Error:', error));
    });
});

//sell pe limit
    document.addEventListener("DOMContentLoaded", function() {
    document.getElementById('put-s-button').addEventListener('click', function() {
        // Get the required fields
        const symbol = document.getElementById('optidx-symbol').value;
        const expiry = document.getElementById('optidx-expiry').value; // Updated ID here
        const limitQty = document.getElementById('put-limit-qty').value;
        const strike = document.getElementById('put-strike').value;
        const limitPrice = document.getElementById('put-limit-price').value;


        // Prepare form data
        const formData = new FormData();
        formData.append('symbol', symbol);
        formData.append('expiry', expiry);
        ///check
        formData.append('limitQty', limitQty);
        formData.append('strike', strike);
        formData.append('limitPrice', limitPrice);

        // Send AJAX POST request
        fetch("/sell-put-optidx/", {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            },
            body: formData
        })
        .then(response => {
            if (response.ok) {
                return response.json();
            }
            throw new Error('Network response was not ok.');
        })
        .then(data => {
            console.log("BUY CE order placed successfully");
            // Optionally, add success feedback to the user here
        })
        .catch(error => console.error('Error:', error));
    });
});

////////////net position update functionality /////////////
    function fetchPositions() {
    fetch('/fetch-positions/')
        .then(response => response.json())
        .then(data => {
            const positionsBody = document.getElementById('positions-body');
            positionsBody.innerHTML = ''; // Clear existing rows

            data.forEach(position => {
                const row = document.createElement('tr');

                row.innerHTML = `
                    <td class="px-3 py-2 border">${position.tradingsymbol}</td>
                    <td class="px-3 py-2 border">${position.avgnetprice}</td>
                    <td class="px-3 py-2 border">${position.lotsize}</td>
                    <td class="px-3 py-2 border"></td> <!-- S/L -->
                    <td class="px-3 py-2 border"></td> <!-- Target -->
                    <td class="px-3 py-2 border">${position.netqty > 0 ? 'B' : 'S'}</td>
                    <td class="px-3 py-2 border">${position.netprice}</td>
                    <td class="px-3 py-2 border">${position.pnl}</td>
                    <td class="px-3 py-2 border">${position.unrealised}</td>
                    <td class="px-3 py-2 border"><button class="p-1 bg-red-500 text-white rounded">Action</button></td>
                `;

                positionsBody.appendChild(row);
            });
        })
        .catch(error => console.error('Error fetching positions:', error));
}

// Fetch positions every 1 second
setInterval(fetchPositions, 1000);


    ///////fetch optidx ltp spot
    // Function to update only the LTP in the label every second
function updateLTPLabel() {
    const symbol = document.getElementById('optidx-symbol').value; // Get the selected symbol

    if (symbol) {
        fetch(`/fetch-ltp-spot/?symbol=${symbol}`)
            .then(response => response.json())
            .then(data => {
                // Update the label with the current LTP
                const displaySection = document.querySelector('#optidx-panel h1');
                displaySection.textContent = `${data.symbol} - LTP: ${data.LTP}`;
            })
            .catch(error => console.error('Error fetching LTP:', error));
    }
}

// Call updateLTPLabel every second
setInterval(updateLTPLabel, 1000);

//update call and put ltp
 // Function to update call and put LTP every second
function updateCallPutLTP() {
    const symbol = document.getElementById('optidx-symbol').value;
    const expiry = document.getElementById('optidx-expiry').value;
    const callStrike = document.getElementById('call-strike').value;
    const putStrike = document.getElementById('put-strike').value;

    fetch(`/update-call-put-ltp/?symbol=${symbol}&expiry=${expiry}&call_strike=${callStrike}&put_strike=${putStrike}`)
        .then(response => response.json())
        .then(data => {
            console.log("Call Symbol:", data.call_symbol);
            console.log("Put Symbol:", data.put_symbol);
            console.log("Call LTP:", data.call_ltp);
            console.log("Put LTP:", data.put_ltp);

            // Update the UI with the LTP values if needed
            document.getElementById('call-ltp').textContent = `LTP: ${data.call_ltp}`;
            document.getElementById('put-ltp').textContent = `LTP: ${data.put_ltp}`;
        })
        .catch(error => console.error('Error updating call/put LTP:', error));
}

// Call the function every second to update LTP
setInterval(updateCallPutLTP, 1000);


</script>




</body>

</html>
